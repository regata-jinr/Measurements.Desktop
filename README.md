# REGATA Measurements.UI

Репозиторий содержит

* код программы реализующей графический интерфейс
пользователя для автоматизации процесса измерений на установке РЕГАТА
* инструкции для работы с программой


Ознакомится с проводимыми исследованиями можно на [сайте нашего сектора](http://regata.jinr.ru/).

Описываемый интерфйес представляет собой графическую обертку над ядром, которое реализует основную логику процесса. Программное ядро измерений содержится в репозитории [MeasurementsCore](https://github.com/regata-jinr/MeasurementsCore)

Программное ядро подключено к системе логгирования, таким образом аткуальную информацию(на текущий день) можно смотреть с помощью специального [монитора](http://regata.jinr.ru/monitor/), программа монитора доступна в репозитории [Measurements.WebMonitor](https://github.com/regata-jinr/Measurements.WebMonitor)
<br>

## Инструкция по работе с графическим интерфейсом пользователя программы "Измерения" на установке РЕГАТА

#### Содержание
1.   [Введение]()     
1.1  [Базовые понятия и описание работы программы]()
2.   [Вход в программу]()        
2.1. [Создание персонального пин-кода]()
3.   [Панель управления сессиями]()
4.   []()
5.   []()

### Введение

Программа предназначена для автоматизации процесса набора спектров облученных образцов на экспериментальной установке РЕГАТА. Программа не является универсальной и напрямую связана с архитектурой установки, как с программной так и с экспериментальной.

### Перед началом работы

Перед начало работы с программой необходимо убедиться в том, что у Вас есть необходимые права для:
 1. Доступа к базе экспериментальных данных сектора нейтронного активационного анализа и прикладных исследований;
 2. Внесения изменений в базу данных, проводимых через описываемую программу;

#### Базовые понятия и описание работы программы
> **Панель управления сессиями измерений, Сессия измерений, Измерение, Образец, Веб-Монитор измерений**

Файл с программой носит название MeasurementsDesktop.exe и устанавливается через запуск программы-инсталлятора, последнюю версию которой можно взять по [ссылке](). 

После установки программа размещается на рабочем столе и будет обновляться автоматически.

### Вход в программу

После запуска программы открывается окно ввода пары логин-пароль:
![](https://sun9-61.userapi.com/c851524/v851524040/1d0819/gqIiuFphpp4.jpg)

Пара логин-пароль соответствует той, что пользователь имеет для доступа к базе данных эксперимента.

#### Создание персонального пин-кода

В силу применения политики паролей при доступе к базе данных эксперимента, имеется возможность создать пин-код. Для этого нужно нажать на кнопку с надписью "создать пин-код", которая находится на форме ввода пары логин-пароль. После нажатия форма изменится на следующую:
![](https://sun9-47.userapi.com/c855020/v855020040/116494/jzJJ4r-8utA.jpg)

**Пин-код должен обязательно состоять из 4-х цифр**, кроме того **остальные поля должны быть заполнены действующей парой логин-пароль**.

После того, как Вы сохраните пин-код программа начнет распознавать пользователя и предлагать ввести пин-код вместо пароля:
![](https://sun1-84.userapi.com/c848016/u3549405/docs/d5/9f0fe3275f0a/pinCodeDemo.gif)

Также стоит отметить тот факт, что форма ввода пары логин-пароль загружается с активным полем ввода логина, по нажатию клавиши таб переходит на поле ввода пароля, а при нажатие клавиши enter инициирует нажатие кнопки с надписью "Войти".

### Панель управления сессиями

#### Сессия измерений
После того как пользователь ввел корректную пару логин-пароль, загружается форма панели управления сессиями:

![](https://sun9-25.userapi.com/c855020/v855020040/1164d2/GxMJVEtJOmg.jpg)

Сессия измерений, это понятие, которое описывает весь процесс проведения автоматического набора спектров:

1. Указание детекторов на которых будет производиться набор спектров
2. Указание типа измерений - SLI|LLI-1|LLI-2|FON
3. Выбор даты журнала облучения
4. Выбор образцов для измерения
5. Установка продолжительности измерений
6. Установка режима измерений [aCountToRealTime,...]

#### Загрузка сохраненных параметров сессии

Форма содержит таблицу, в которой показаны сохраненные сессии.
Выделенную сессию можно загрузить, тем самым избежать ручного ввода параметров сессии, которые описаны выше.

**Панель управления позволяет создать несколько сессий для параллельного проведения измерений разных образцов на разных детекторах.**

#### Создание новой сессии

При необходимости можно создать пустую сессию. Для этого нужно нажать на кнопку с надписью "Создать новую сессию". После этого откроется окно новой сессии измерений:

![](https://sun9-30.userapi.com/c855020/v855020040/116512/0DeK1s75OBU.jpg)

Окно условно делится на 4 области управления и контроля за состоянием измерений:
![](https://sun9-44.userapi.com/c855020/v855020168/112822/phsAM7lwE10.jpg)

##### 1. Строка меню

Строка меню имеет следующую структуру:

1. **Меню**
   1.1. **Сохранить сессию** - позволяет записать параметры текущей сессий в БД, для последующей загрузки. Уникальным идентификатором сессия является ее имя. При нажатии на это подменю будет показано следующая форма:

   ![](https://sun9-60.userapi.com/c855736/v855736340/1185f5/f_s2EbyHW7k.jpg)

   Эта форма позволяет сохранить сессию с указанным именем, кроме того отметить - должна ли быть сессия видна всем пользователям или только тому, кто ее сохраняет.

2. **Детекторы** - данное подменю отображает список детекторов доступных для подключения. Список формируется автоматически на основе базы данных подключенных устройств формируемой Genie2k:
![](https://sun9-46.userapi.com/c855736/v855736340/118611/Bs7_ojMKWag.jpg)
Тот же список в подменю детекторы:
![](https://sun9-6.userapi.com/c855736/v855736787/1169d3/tshkdPkDkFc.jpg)
По клику на детектор, он будет отмечен как выбранный для проведения измерений.

3. **Тип** - подменю типа позволяет выбрать тип измерений
   ![](https://sun9-49.userapi.com/c855736/v855736787/1169dd/Db0USwPBa-E.jpg)
   После выбора типа заполнится список дат журналов облучений, а также таблица образцов для измерений, которая заполняется при выборе конкретной даты из списка.
   ![](https://psv4.userapi.com/c848220/u3549405/docs/d11/4e7d91e9deb9/DetAndTypeListsDemo.gif)
   Так как при составлении списка автоматически выбирается наиболее поздняя дата, этот список формируется автоматически при выборе детекторов и типа.

4. **Опции**
  4.1 **Режим набора** - представляет собой все значения режимов набора спектра доступные в Genie2K.

##### 2. Таблица образцов для измерений

Описываемая таблица содержит следующие поля:

* **SetKey** - код партии образца
* **SampleNumber** - номер образца
* **Container** - номер контейнера
* **PositionInContainer** - номер контейнера
* **Detector** - имя детектора, на котором будет произведен набор спектра образца
* **DiskPosition** - позиция образца на диске
* **DeadTime** - значения мертвого времени при измерении данного образца
* **Height** - высота, на которой был установлен образец, при наборе спектра
* **File** - имя файла спектра

____
> #### **Важно отметить, что эта таблица соответствует предстоящим измерениям. Таким образом она формируется заново каждый раз при выборе типов, дат, детекторов. Тем самым, позволяя провести набор спектров для одной и той же партии несколько раз**
____

Слева содержится список дат, в которые производились облучения. Выбор, выделение, клик конкретной даты, порождает обновление таблицы образцов измерений в соответствии с образцами, которые были облучены в выбранную дату.

##### 3. Управление измерениями

После добавлении детекторов к сессии, выборе типа и даты облучения, а значит формирования списка образцов, необходимо задать продолжительность измерений. Это можно сделать через нажатие на параметр "Продолжительность измерений" в строке состояния:

![](https://psv4.userapi.com/c848428/u3549405/docs/d6/0a728bbd35b9/SetCountsDemo.gif)


Теперь программа готова к запуску процесса набора спектров. Окно сессии в этом случае выглядит следующим образом:

##### 3.1 Запуск измерений

Нажатие на кнопку с надписью "Start" приведет к запуску измерений:

![](https://psv4.userapi.com/c848020/u3549405/docs/d10/afeae6808011/StartDemo.gif)

Разберем, что происходит после нажатия:

Сначала происходят проверки на заполненность необходимой информации:

> **Сессия должна контролировать хотя бы один детектор**
> **Должен быть выбран тип измерений**
> **Должен быть сформирован список образцов для измерений**
> **Должна быть задана продолжительность измерений**

После того, как все требования из списка выше удовлетворены, программа запускает окно программы "Набор и анализ гамма спектров" и подключает к нему детекторы, которыми управляет сессия.

> **Окно программы "Набор и анализ гамма спектров" находится в режиме для чтения. Здесь можно смотреть всю необходимую информацию о проводимых измерениях, однако нельзя управлять ими. Для этого используйте программный интерфейс**

##### Описание процесса одного измерения

Рассмотрим подробно процесс одного измерения.

1. При формировании списка образцов для измерений, каждому детектору устанавливается текущий образец, спектр которого будет набран первым.
2. Затем запускается непосредственно сам процесс набора спектра, при котором в файл прописываются все необходимые параметры:
   * Тип, номер партии, номер образца, логин обработчика, время облучения, вес, геометрия

3. После того как измерения закончились, с детектора обрабатывается соответствующий сигнал. В случае, если никаких ошибок не было. Записывается файл спектра в директорию "D:\Spectra\CurrentYear\CurrentMonth\ChosenType" имя спектра генерируется автоматически на основе имен записанных в базу данных эксперимента. В базе данных установлено ограничение на дубликаты имен файл спектров: файл спектра должен иметь уникальное имя.

![](https://psv4.userapi.com/c856536/u3549405/docs/d8/9d24444d1597/SaveToDBAndToLocalStorageDemo.gif)



### Отслеживание процесса измерений в режиме реального времени

#### 4. Строка состояния

Строка состояния отображает состояния всего процесса измерений и каждой его части в отдельности. В частности подключенные детекторы и их статус. Тип, режим набора, и время. А также обновляемую панель прогресса измерений:

![](https://sun9-5.userapi.com/c857536/v857536173/993c2/aCAHnk4TrRI.jpg)

#### Web-monitor

Каждая операция ядра программы производит запись в специальный журнал. Таким образом, доступ к этому журналу дает полную информацию о том, что происходило с процессом измерений.

Журнал выведен в онлайн и доступен по [ссылке](http://regata.jinr.ru/monitor/)


В нем показана информация только за текущий день. Таким образом до начала процесса измерений пустой журнал выглядит так:

![](https://sun9-42.userapi.com/c851324/v851324173/1d2215/S-qkS-LskN0.jpg)

После проведения измерений заполненный журнал будет содержать подробную информацию о проводимых измерениях:

![](https://sun9-23.userapi.com/c851020/v851020173/1d493a/QxxhiBVhQoY.jpg)



### Параллельные измерения разных образцов на разных детекторах

